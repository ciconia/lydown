\version "2.18.2"

<% unless self['render_opts/no_lib'] %>
\pinclude "<%= File.join(LY_LIB_DIR, 'lib.ly') %>"
<% end %>

<% packages = Lydown::Rendering.packages_to_load(self, {}) %>
<% packages.each do |p| %>
  \require "<%= p %>"
<% end %>

<% includes = Lydown::Rendering.include_files(self, {}) %>
<% includes.each do |i| %>
  <%= i %>
<% end %>

<% if self.render_mode == :proof %>
<%= Lydown::Rendering::PROOFING_LY_SETTINGS %>
<% end %>

<% if self['layout'] %>
\layout {
}
<% end %>

<%= Lydown::Templates.render(:variables, self) %>

\book {
  \header {
  }

  \bookpart {
  <% self['movements'].each do |n, m| %>
    <%= Lydown::Templates.render(:movement, self, name: n, movement: m) 
    %>
  <% end %>
  
  }
}
